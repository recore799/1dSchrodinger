#!/usr/bin/env python3

import numpy as np
import matplotlib.pyplot as plt

class Integrator:
    def __init__(self,V, xL=-5, xR=5, n=201):
        """
        Initializes the Numerov solver for the harmonic oscillator.

        The Schrödinger equation (in adimensional units) is:
            -ψ''(x) + x^2 ψ(x) = E ψ(x)
        which we write as:
            ψ''(x) = (x^2 - E) ψ(x).

        Parameters:
            xL: float, left boundary of the spatial grid.
            xR: float, right boundary of the spatial grid.
            n: int, number of grid points.
        """
        self.xL = xL
        self.xR = xR
        self.V = V
        self.n = n
        self.x, self.h = np.linspace(xL, xR, n, retstep=True, dtype=float)

    def numerov(self, E):
        """
        Computes the wavefunction using Numerov's method for a given energy E.

        Parameters:
            E: float, the trial energy.

        Returns:
            psi: 1D NumPy array, the computed wavefunction on the grid.

        The equation solved is:
            ψ''(x) = -[E-x^2]ψ(x)
        """
        psi = np.zeros(self.n, dtype=float)
        # Set boundary conditions.
        # We assume that at the far left (xL) we are in the classically forbidden region.
        # For simplicity, we set psi(xL)=0 and a small nonzero value at the next point.
        psi[0] = 0.0
        psi[1] = 0.001

        # g(x)
        G = E-self.V(self.x)

        F = 1 + (self.h**2 / 12.0) * G


        # Numerov recurrence: for i = 1 to n-2:
        for i in range(1, self.n - 1):
            psi[i+1] = ((12-10*F[i])*psi[i] - F[i-1]*psi[i-1]) / F[i+1]
        return psi


def V_ho(x):
    return x**2

if __name__ == "__main__":
    # Create an instance of the solver.
    solver = Integrator(V=V_ho)

    # Known eigenvalues for the harmonic oscillator (in adimensional units) are:
    # E_n = n + 1/2, for n = 0, 1, 2, ...
    energies = [1, 3, 5, 7, 9]

    plt.figure(figsize=(10, 6))
    for E in energies:
        psi = solver.numerov(E)
        # Normalize the wavefunction.
        norm = np.sqrt(np.trapezoid(psi**2, solver.x))
        psi_norm = psi / norm

        plt.plot(solver.x, psi_norm, label=f"E = {E:.1f}")

    plt.xlabel("x")
    plt.ylabel("Normalized ψ(x)")
    plt.title("Harmonic Oscillator Eigenfunctions (Numerov Method)")
    plt.legend()
    plt.grid(True)
    plt.show()
